- if @team
  = javascript_include_tag "http://js.pusher.com/2.1/pusher.min.js"
  - solver_id = (0..5).map{random_char}.join('')
  - display_name = @current_user ? (@current_user.first_name || @current_user.username) : 'anon_'+solver_id
  - channel = "#{@crossword.id}_#{@solution.key}"
  :javascript
    var pusher = new Pusher("#{Pusher.key}");
    var channel = "#{channel}";
    team_app = {};
    team_app.display_name = "#{display_name}";
    team_app.solver_id = "#{solver_id}";

= javascript_include_tag 'solve'
= content_for :head do
  = stylesheet_link_tag "crossword"

- if @team
  = javascript_include_tag 'crosswords/team_funcs'

  - if @current_user && @solution.user_id == @current_user.id
    #myModal.reveal-modal{:'data-reveal' => true}
      %h2
        Crosswords: More Fun as a Team
        %i.fi-torsos-all
      %p.lead
        Solve puzzles with your friends in
        %strong real-time
        \-- just send them the link to this puzzle!
      %input.lead{value: request.original_url, style: 'margin-left: 2em; width: 40%; cursor: pointer', readonly: 'readonly', onclick: '$(this).select();'}
      %i.lead.fi-link{style: 'font-size: large; padding: 0.2em 0.3em;'}
      %p.lead
      %p Now to find some friends...
      %a.close-reveal-modal Ã—

  #team-chat.down
    .row.row-topper
      Team Chat
      %i.fi-plus#chat-minmax
    #chats
    = form_tag(send_team_chat_solution_path(@solution), remote: true) do
      = hidden_field_tag 'display_name', display_name, id: nil
      = hidden_field_tag 'channel', channel, id: nil
      = hidden_field_tag 'avatar', @current_user ? @current_user.image.thumb : asset_path('default_images/default_user_img.jpg'), id: nil
      = text_field_tag 'chat', nil, id: nil

  #test-overlay

:javascript
  solve_app.solution_id = "#{@solution.id if @solution}"

- if @current_user == @crossword.user
  .alert-box{data: {alert: true}}
    %div.center
      You are the creator of this puzzle.
      -if !@crossword.published
        %br
        = link_to('Edit Puzzle', edit_crossword_path(@crossword))
        or
        = link_to('Publish Puzzle', publish_crossword_path(@crossword), data: {confirm: 'Are you sure you want to publish this puzzle?\nPublished puzzles cannot be edited or deleted.'})
      %a.slide-close{href: "#"} &times;

.row#credit-area
  .large-12.columns
    %h3
      = @crossword.title
      %span#creator-credit= "by #{ @crossword.user.present? ? @crossword.user.display_name : '[deleted]' }"
    #puzzle-controls
      %span#save-status.smaller No changes yet
      %span#save-clock.smaller
      - if @current_user
        %a#solve-save.button.tiny.secondary{href: '#', :'data-tooltip' => true, title: 'Quicksave'}
          %i.fi-save
        = link_to(favorite_crossword_path(@crossword), title: 'Favorite', :'data-tooltip' => true, class: "button tiny secondary#{(@current_user.favorites.include? @crossword) ? ' hidden' : ''}", method: :post, id: 'favorite', remote: true) do
          %i.fi-star>
        = link_to(unfavorite_crossword_path(@crossword), title: 'Unfavorite', :'data-tooltip' => true, class: "button tiny secondary#{(@current_user.favorites.include? @crossword) ? '' : ' hidden'}", method: :delete, id: 'unfavorite', remote: true) do
          %i.fi-star{style: 'color: #ff7878;'}>
      - if @team
        %div.button.tiny.secondary
          %i.fi-torsos-all
          Team
          #teammates
      - else
        = link_to create_team_crossword_path(@crossword), method: 'post', class: 'button tiny secondary rounded', id: 'solve-share', 'data-tooltip' => true, title: 'Solve collaboratively' do
          %i.fi-torsos-all
          Team


.row#solve-area
  .large-12.columns
    = render partial: 'crosswords/partials/solve_crossword'
.row#meta-area
  .large-12.columns
    .row
      .large-2.columns
        = link_to @crossword.user do
          = image_tag(@crossword.user.image.creator_pic, class: 'small-shadow thin-border')
      .large-10.columns
        %p
          %em= @crossword.description
          = '--'
          = link_to @crossword.user.display_name, @crossword.user
    %hr
    %section#comments
      %h3
        %i.fi-comments
        Comments
      / Feed Entry
      -if @current_user
        = form_tag(add_comment_path(@crossword), remote: true, id: 'comment-form') do
          = text_area_tag('content', nil, id: 'add-comment', placeholder: 'What did you think of this puzzle?')
      -else
        =link_to 'Sign up', new_user_path
        or
        Log in
        to comment on this puzzle
      %hr
      - @crossword.comments.each do |comment|
        = render partial: 'comments/partials/comment', locals: {comment: comment}