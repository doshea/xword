(function(){window.solve_app={logged_in:null,crossword_id:null,solution_id:null,save_timer:null,clock_updater:null,last_save:null,unsaved_changes:!1,ready:function(){return solve_app.anonymous||(solve_app.save_timer=window.setInterval(function(){if(solve_app.unsaved_changes)return solve_app.save_solution()},5e3),solve_app.clock_updater=window.setInterval(solve_app.update_clock,1e4),$("#comments").on("keypress",".reply-content",solve_app.add_comment_or_reply),$("#comments").on("click",".reply-button.reply",solve_app.toggle_reply_form),$("#solve-save").on("click",solve_app.save_solution),$("#add-comment").on("keypress",solve_app.add_comment_or_reply),$(".cancel-button").on("click",solve_app.toggle_reply_form)),$("#controls-button").on("click",function(e){return e.preventDefault(),$("#controls-modal").foundation("reveal","open")}),$("#check-cell").on("click",solve_app.check_cell),$("#check-word").on("click",solve_app.check_word),$("#check-puzzle").on("click",solve_app.check_puzzle),$("#solve-controls").on("click",".check-completion :not(span)",solve_app.check_completion),$("input, textarea").on("click",function(){return cw.unhighlight_all()}),solve_app.check_all_finished(),!0},save_solution:function(e){var t,s,l;return e&&e.preventDefault(),l=$("#crossword").data("auth-token"),t=cw.get_puzzle_letters(),s={dataType:"script",type:"PUT",url:"/solutions/"+solve_app.solution_id,data:{authenticity_token:l,letters:t}},$.ajax(s)},log_save:function(){return solve_app.last_save=moment().format("dddd, MMMM Do YYYY, h:mm:ss a"),solve_app.unsaved_changes=!1},update_clock:function(){if(solve_app.last_save&&!solve_app.anonymous)return $("#save-status").text("Saved "),$("#save-clock").text(moment(solve_app.last_save).fromNow())},update_unsaved:function(){if(!solve_app.anonymous)return solve_app.unsaved_changes=!0,$("#save-status").text("Unsaved changes"),$("#save-clock").empty()},check_cell:function(e){var t,s,l;if(e.preventDefault(),cw.selected)return cw.selected.is_empty_cell()?alert("This cell is empty."):(t=cw.selected.data("index"),s=cw.selected.get_letter(),l={dataType:"script",type:"POST",url:"/crosswords/"+solve_app.crossword_id+"/check_cell",data:{letters:[s],indices:[]}},l.data.indices.push(t),$.ajax(l),solve_app.save_solution())},check_word:function(e){var t,s,l,o,a,n,c;if(e.preventDefault(),cw.selected){for(c={dataType:"script",type:"POST",url:"/crosswords/"+solve_app.crossword_id+"/check_cell",data:{letters:[],indices:[]}},n=cw.selected.get_word_cells(),s=0,o=n.length;s<o;s++)t=n[s],t.is_empty_cell()||(l=t.data("index"),a=t.get_letter(),c.data.indices.push(l),c.data.letters.push(a));return 0===c.data.letters.length?alert("The selected word is empty."):($.ajax(c),solve_app.save_solution())}},check_puzzle:function(e){var t;return e.preventDefault(),solve_app.save_solution(),t={dataType:"script",type:"POST",url:"/crosswords/"+solve_app.crossword_id+"/check_cell",data:{letters:cw.get_puzzle_letters()}},$.ajax(t),solve_app.save_solution()},check_completion:function(e){var t,s;return e.preventDefault(),solve_app.save_solution(),t=cw.get_puzzle_letters(),s={dataType:"script",type:"POST",url:"/crosswords/"+solve_app.crossword_id+"/check_completion",data:{letters:t}},solve_app.anonymous||(s.data.solution_id=solve_app.solution_id),$.ajax(s)},add_comment_or_reply:function(e){var t;if(!e.metaKey&&(t=e.which,t===cw.ENTER&&(e.preventDefault(),""!==$(this).val())))return $(".replying").removeClass("replying"),$(this).closest(".comment").addClass("replying"),$(this).parent().submit(),$(this).val("")},toggle_reply_form:function(e){var t,s;return e&&e.preventDefault(),s=$(this).siblings("form"),s.toggle("fast"),$(this).siblings("a").toggle(),$(this).toggle(),t=s.css("opacity")<.5,t?s.children("textarea").focus():s[0].reset()},check_all_finished:function(){return $.each($(".cell:not(.void)"),function(e,t){if($(t).has_left()||$(t).in_finished_across_word()&&$(t).corresponding_across_clue().addClass("crossed-off"),!$(t).has_above()&&$(t).in_finished_down_word())return $(t).corresponding_down_clue().addClass("crossed-off")})}},function(e){return e.fn.delete_letter=function(e){return this.is_empty_cell()?this.is_word_start()?void 0:(this.previous_cell().is_empty_cell()||(this.previous_cell().delete_letter(!0),solve_app.update_unsaved()),this.previous_cell().highlight(),!1):(this.children(".letter").first().empty(),"undefined"!=typeof team_app&&null!==team_app&&(e?team_app.send_team_cell(this,""):this.uncheck_unfinisheds()),solve_app.update_unsaved())}}(jQuery),$(document).ready(solve_app.ready)}).call(this);