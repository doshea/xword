(function(){cw.editing=!0,window.edit_app={unsaved_changes:!1,save_timer:null,last_save:null,SAVE_INTERVAL:15e3,title_spinner:null,save_counter:null,ready:function(){return edit_app.save_timer=window.setInterval(function(){if(edit_app.unsaved_changes)return edit_app.save_puzzle()},edit_app.SAVE_INTERVAL),$("#title-status").show(),$("#crossword").on("dblclick",".cell",function(){return $(this).toggle_void(!0)}),$("#edit-save").on("click",edit_app.save_puzzle),$("#title").on("change",edit_app.update_title),$(".clue").on("change","input",edit_app.update_clue),$(".clue").on("click",function(){return $(".cell[data-index="+$(this).data("index")+"]").highlight()}),$("#description").on("change",edit_app.update_description),$(".switch-form input").on("click",edit_app.flip_switch),$(":not(.cell, .cell *, .clue, .clue *)").on("click",function(){return cw.unhighlight_all()}),$("#ideas input[name=word]").on("keypress",edit_app.add_potential_word),$("#settings-button").on("click",function(){return $("#edit-settings").foundation("reveal","open")}),$(".bottom-button").on("click",function(){return $(this).closest(".slide-up-container").toggleClass("open")})},flip_switch:function(){return $(this).parent().toggleClass("on off"),$(this).closest("form").submit()},add_potential_word:function(e){var t;if(!e.metaKey&&(t=e.which,t===cw.ENTER&&(e.preventDefault(),""!==$(this).val())))return $(this).parent().submit()},update_clue:function(){return edit_app.update_unsaved()},update_title:function(){var e,t,i,n;return i=$("#title-status"),i.css("opacity",1),n=$("#crossword").data("auth-token"),e=$("#crossword").data("id"),t={dataType:"script",type:"PUT",url:"/unpublished_crosswords/"+e,data:{unpublished_crossword:{title:$("#title").val()},authenticity_token:n},success:function(){return i.addClass("fi-check").removeClass("fi-x")},error:function(){return i.addClass("fi-x").removeClass("fi-check")},complete:function(){return i.fadeTo(1500,0,function(){return i.removeClass("fi-check fi-x")})}},$.ajax(t)},update_description:function(){var e,t,i;return i=$("#crossword").data("auth-token"),e=$("#crossword").data("id"),t={dataType:"script",type:"PUT",url:"/unpublished_crosswords/"+e,data:{unpublished_crossword:{description:$("#description").val()},authenticity_token:i},error:function(){return alert("Error updating title!")}},$.ajax(t)},update_unsaved:function(){return edit_app.unsaved_changes=!0,edit_app.save_counter=Math.random().toString(),$("#save-status").text("Unsaved changes"),$("#save-clock").empty()},spin_title:function(){var e,t;return $(".spinner").remove(),e={lines:10,length:7,width:4,radius:6,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},t=document.getElementById("title-status"),edit_app.title_spinner=new Spinner(e).spin(t)},number_clues:function(){return $(".clue").each(function(){var e,t,i;return i=$(this).children(".clue-num"),e=$(this).data("index"),t=parseInt($(".cell[data-index="+e+"]").first().attr("data-cell")),i.text(t+".")})},save_puzzle:function(){var e,t,i,n,s,r,a;return s=[],e=$(".cell"),$.each(e,function(e,t){return $(t).is_void()?s[e]=0:s[e]=$(t).get_letter()}),t=[],i=[],$.each($(".across-clue"),function(){return t.push($(this).children("input").val())}),$.each($(".down-clue"),function(){return i.push($(this).children("input").val())}),a=$("#crossword").data("auth-token"),n=$("#crossword").data("id"),r={dataType:"script",contentType:"application/json",type:"PATCH",url:"/unpublished_crosswords/"+n+"/update_letters",data:JSON.stringify({letters:s,circles:edit_app.circles,across_clues:t,down_clues:i,authenticity_token:a,save_counter:edit_app.save_counter}),success:function(){return console.log("Saved!")},error:function(){return alert("Error updating letters!")}},console.log("Saving..."),$.ajax(r)},log_save:function(){return edit_app.last_save=moment().format("dddd, MMMM Do YYYY, h:mm:ss a"),edit_app.unsaved_changes=!1},update_clock:function(){if(edit_app.last_save)return $("#save-status").text("Saved "),$("#save-clock").text(moment(edit_app.last_save).fromNow())}},function(e){return e.fn.corresponding_clues=function(){return e(".clue[data-index="+this.data("index")+"]")},e.fn.delete_letter=function(){return this.is_empty_cell()?this.is_word_start()?void 0:(this.previous_cell().is_empty_cell()||this.previous_cell().delete_letter(!0),this.previous_cell().highlight(),!1):this.children(".letter").first().empty()},e.fn.get_mirror_cell=function(){var t,i,n;return t=e(".cell"),i=t.length,n=e.inArray(this[0],t),e(t[i-n-1])},e.fn.toggleCircle=function(){var t,i,n,s;return n=e(this).children(".circle"),s=e(this).data("index"),i=edit_app.circles.split(""),n.length>0?(n.remove(),i[s]=" "):(t=e("<div>").addClass("circle"),e(this).append(t),i[s]="o"),edit_app.circles=i.join(""),edit_app.update_unsaved()},e.fn.toggle_void=function(t){var i,n;return this.set_letter(""),this.toggleClass("void"),this.hasClass("void")?(this.corresponding_clues().hide(),this.has_below()&&this.cell_below().corresponding_clues().filter(".down-clue").show(),this.has_right()&&this.cell_to_right().corresponding_clues().filter(".across-clue").show()):(this.has_below()&&this.cell_below().corresponding_clues().filter(".down-clue").hide(),this.has_right()&&this.cell_to_right().corresponding_clues().filter(".across-clue").hide(),this.cell_above()||this.corresponding_clues().filter(".down-clue").show(),this.cell_to_left()||this.corresponding_clues().filter(".across-clue").show()),t&&e("#unpublished_crossword_mirror_voids").prop("checked")&&(i=this.get_mirror_cell(),this[0]!==i[0]&&this.hasClass("void")!==i.hasClass("void")&&i.toggle_void(!1)),t&&(n=cw.select_across?this.cell_to_right():this.cell_below(),n.highlight()),cw.number_cells(),edit_app.number_clues(),edit_app.update_unsaved()}}(jQuery),$(document).ready(edit_app.ready)}).call(this);