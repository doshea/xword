(function(){window.cw={selected:null,select_across:!0,counter:1,editing:!1,UP:38,RIGHT:39,DOWN:40,LEFT:37,COMMAND:91,ENTER:13,SPACE:32,DELETE:8,SHIFT:16,TAB:9,ESCAPE:27,BACKSPACE:8,HYPHEN:189,unhighlight_all:function(){if(cw.selected)return cw.selected.removeClass("selected"),cw.selected=null,$(".selected-word").removeClass("selected-word"),$(".selected-clue").removeClass("selected-clue")},highlight_next_word:function(){var e,c;return e=$(".clue.selected-clue"),c=e.nextAll(":not(.hidden)").first(),c.hasClass("clue")?cw.highlight_clue_cell(c):cw.highlight_clue_cell(e.parent().parent().siblings(".clue-column").first().children().children().first())},scroll_to_selected:function(){var e,c,t;return c=$(".selected-clue"),e=c.closest("ol"),t=e.scrollTop()+c.position().top-e.height()/2+c.height()/2,e.stop().animate({scrollTop:t},100)},selected_word:function(){var e;return e="",$.each($(".selected-word"),function(c,t){return e+=$(t).get_letter()}),e},word_highlight:function(){var e,c,t;return $(".selected-word").removeClass("selected-word"),e=$(".selected"),t=e.get_word_cells(),$.each(t,function(e,c){return c.addClass("selected-word")}),c=e.get_start_cell(),c.corresponding_clue().addClass("selected-clue"),cw.scroll_to_selected()},get_puzzle_letters:function(){var e,c;return c="",e=$(".cell"),$.each(e,function(e,t){return c+=$(t).hasClass("void")?"_":$(t).get_letter()}),c},number_cells:function(){var e,c;return cw.counter=1,e=$(".cell:not(.void)"),$.each(e,function(e,c){return cw.number_cell($(c))}),c=1},number_cell:function(e){return e.has_above()&&e.has_left()?" "!==e.get_number()?(e.set_number(""),e.removeAttr("data-cell")):void 0:(e.set_number(cw.counter),e.attr("data-cell",cw.counter),cw.counter+=1)},keypress:function(e){var c,t,l,s;if(!(e.ctrlKey||e.altKey||e.metaKey)&&cw.selected&&0===$(":focus").length)switch(t=e.which){case cw.UP:if(cw.selected)return cw.selected.cell_above()?cw.selected.cell_above().highlight():(s=cw.selected.get_col_end(),s.is_void()&&(s=s.cell_above()),s.highlight());break;case cw.RIGHT:if(cw.selected)return cw.selected.cell_to_right()?cw.selected.cell_to_right().highlight():(s=cw.selected.get_row_beginning(),s.is_void()&&(s=s.cell_to_right()),s.highlight());break;case cw.DOWN:if(cw.selected)return cw.selected.cell_below()?cw.selected.cell_below().highlight():(s=cw.selected.get_col_beginning(),s.is_void()&&(s=s.cell_below()),s.highlight());break;case cw.LEFT:if(cw.selected)return cw.selected.cell_to_left()?cw.selected.cell_to_left().highlight():(s=cw.selected.get_row_end(),s.is_void()&&(s=s.cell_to_left()),s.highlight());break;case cw.TAB:return e.preventDefault(),cw.highlight_next_word();case cw.ESCAPE:return e.preventDefault(),cw.unhighlight_all();case cw.ENTER:return e.preventDefault(),cw.selected.next_empty_cell().highlight();case cw.SHIFT:break;case cw.DELETE:break;case cw.SPACE:return cw.select_across=!cw.select_across,$(".selected").highlight();default:if(cw.selected&&(l=String.fromCharCode(t),t===cw.HYPHEN&&(l="-"),l!==cw.selected.get_letter()&&(cw.editing?(cw.selected.set_letter(l,!0),edit_app.update_unsaved()):(c=cw.selected.is_empty_cell(),cw.selected.set_letter(l,!0),c&&cw.selected.check_finisheds(),solve_app.update_unsaved())),!cw.selected.is_word_end()))return cw.selected.next_empty_cell_in_word().highlight()}},highlight_clue_cell:function(e){var c;if(c=cw.editing?$(".cell[data-id='"+e.data("cell-id")+"']").first():$(".cell[data-cell='"+e.attr("data-cell-num")+"']").first(),cw.select_across="across"===e.closest(".clues").attr("id"),c.highlight(),cw.editing)return e.children("input").select()},suppressBackspaceAndNav:function(e){var c,t;return e=e||window.event,t=e.target||e.srcElement,e.keyCode!==cw.BACKSPACE||/input|textarea/i.test(t.nodeName)?!(_.contains(cw.PAGE_NAV_KEYS,e.keyCode)&&!/input|textarea/i.test(t.nodeName))&&void 0:(c=!cw.selected.is_empty_cell(),cw.selected.delete_letter(!0),c&&cw.selected.uncheck_unfinisheds(),!1)}},cw.PAGE_NAV_KEYS=[cw.UP,cw.RIGHT,cw.DOWN,cw.LEFT,cw.SPACE],document.onkeydown=cw.suppressBackspaceAndNav,document.onkeypress=cw.suppressBackspaceAndNav,$(function(){return cw.editing||cw.number_cells(),$(document).on("keydown",cw.keypress),$(".cell").on("click",function(e){return e.stopPropagation(),$("#unpublished_crossword_one_click_void").prop("checked")?$(this).toggle_void(!0):$("#unpublished_crossword_circle_mode").prop("checked")?$(this).toggleCircle():$(this).highlight()}),$(".clue").on("click",function(e){return e.stopPropagation(),cw.highlight_clue_cell($(this))}),cw.selected=$(".cell:not(.void)").first(),cw.selected.highlight()})}).call(this);