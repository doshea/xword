(function(){window.team_app={solver_red:(266*Math.random()).floor(),solver_green:(266*Math.random()).floor(),solver_blue:(266*Math.random()).floor(),cell_clack_sound:new Audio("/audios/chuck.mp3"),last_clack:null,message_received_sound:new Audio("/audios/submarine.m4a"),last_received:null,unread_count:0,display_name:team_app.display_name,solver_id:team_app.solver_id,outline_timer:null,toggle_chat:function(){return $("#team-chat").toggleClass("down"),$("#team-chat").css("bottom",""+(-1*$("#team-chat").height()+1.7*$("#team-chat .row-topper").height()/1.5)+"px"),$("#team-chat").hasClass("down")||(team_app.unread_count=0,$("#unread-chat-count").text("")),$("#chat-minmax").toggleClass("fi-minus fi-plus")},send_team_cell:function(e,a){var t,l;return l=$("#crossword").data("auth-token"),t={type:"PATCH",url:"/solutions/"+solve_app.solution_id+"/team_update",data:{authenticity_token:l,letter:a,col:e.data("col"),row:e.data("row"),channel:channel,solver_id:team_app.solver_id,red:team_app.solver_red,green:team_app.solver_green,blue:team_app.solver_blue}},$.ajax(t)},join_team:function(){var e,a;return a=$("#crossword").data("auth-token"),e={type:"POST",url:"/solutions/"+solve_app.solution_id+"/join_team",data:{authenticity_token:a,channel:channel,display_name:team_app.display_name,red:team_app.solver_red,green:team_app.solver_green,blue:team_app.solver_blue,solver_id:team_app.solver_id}},$.ajax(e)},leave_team:function(){var e,a;return a=$("#crossword").data("auth-token"),e={type:"POST",url:"/solutions/"+solve_app.solution_id+"/leave_team",data:{authenticity_token:a,channel:channel,solver_id:team_app.solver_id}},$.ajax(e)},roll_call:function(){var e,a;return a=$("#crossword").data("auth-token"),e={type:"POST",url:"/solutions/"+solve_app.solution_id+"/roll_call",data:{authenticity_token:a,channel:channel}},$.ajax(e)},show_team_clue:function(){var e,a,t,l;return l=$("#crossword").data("auth-token"),a=$(this).data("cell-num"),e=$(this).hasClass("across-clue"),t={type:"POST",url:"/solutions/"+solve_app.solution_id+"/show_team_clue/",data:{authenticity_token:l,channel:channel,cell_num:a,across:e,red:team_app.solver_red,green:team_app.solver_green,blue:team_app.solver_blue,solver_id:team_app.solver_id}},$.ajax(t)},receive_team_cell:function(e){var a,t;if(team_app.solver_id!==e.solver_id)return a=$(".cell[data-row="+e.row+"][data-col="+e.col+"]"),t=Date.now(),team_app.last_clack&&t-team_app.last_clack<4e3||(team_app.last_clack=t,team_app.cell_clack_sound.play()),a.children(".flag").stop().css("background","rgb("+e.red+", "+e.green+", "+e.blue+")").animate({opacity:1},300).delay(300).animate({opacity:0},200),""===e.letter?a.delete_letter(!1):a.set_letter(e.letter,!1)},welcome_teammate:function(e){var a;if(!($(".teammate-box[solver_id="+e.solver_id+"]").length>0))return a=$("<div>"),a.addClass("teammate-box has-tip").css("background","rgb("+e.red+", "+e.green+", "+e.blue+")").attr("data-tooltip",!0).attr("title",e.display_name).attr("solver_id",e.solver_id),$("#teammates").append(a)},farewell_teammate:function(e){return console.log("So long, farewell"),$("#teammates .teammate-box[solver_id="+e.solver_id+"]").fadeOut(1e3,function(){return $(this).remove()})},receive_chat:function(e){var a,t,l,o,n,r,s,_,c;return s=team_app.display_name===e.display_name,o=$(".chat").length>0,l=$("#team-chat"),_=$("<div>"),_.addClass("chat"),s&&_.addClass("my-chat"),s||(r=$("<span>")),t=$("<span>"),s||r.text(e.display_name+": ").addClass("display-name"),t.text(e.chat_text).addClass("chat-text"),s||(a=$("<img>"),a.attr("src",e.avatar).addClass("avatar"),a.appendTo(_),r.appendTo(_)),s?t.prependTo(_):t.appendTo(_),o&&$("<hr />").appendTo($("#chats")),_.appendTo($("#chats")),s||(_.css({"background-color":"#ff7878"}),l.hasClass("down")&&(team_app.unread_count+=1,$("#unread-chat-count").text("("+team_app.unread_count+")")),c=Date.now(),team_app.last_received&&c-team_app.last_received<8e3||(team_app.last_received=c,team_app.message_received_sound.play()),window.setTimeout(function(){return _.css({"background-color":"white"})},.4)),n=$("#chats").get(0).scrollHeight,$("#chats").stop().animate({scrollTop:n},"fast")},outline_team_clue:function(e){var a,t,l,o,n,r,s,_,c,i,p,d;if(e.solver_id!==team_app.solver_id)return _=2,s=e.solver_id+"_word_highlight",r=e.red+", "+e.green+", "+e.blue,i=$("#"+s),i.get(0)||(i=$("<div id='"+s+"'>"),i.addClass("team-outline").hide().css("border",_+"px dashed rgb("+r+")").css("background-color","rgba("+r+", 0.2)"),$("body").append(i)),a="true"===e.across,c=$(".cell[data-cell="+e.cell_num+"]"),d=a?c.get_across_word_cells():c.get_down_word_cells(),n=d.length,t=a?d[0].height()-3:d[0].height()*n+2*n-5,p=a?d[0].width()*n+2*n-5:d[0].width()-3,l=d[0].offset().left+1,o=d[0].offset().top+1,i.height(t),i.width(p),i.offset({top:o,left:l}),i.stop().css("opacity",1).show(),team_app.outline_timer&&clearInterval(team_app.outline_timer),team_app.outline_timer=setTimeout(function(){return i.animate({opacity:0},"fast")},2e4)}},$(function(){var e;return $("#team-explanation").foundation("reveal","open"),e=pusher.subscribe(channel),e.bind("change_cell",team_app.receive_team_cell),e.bind("join_puzzle",team_app.welcome_teammate),e.bind("leave_puzzle",team_app.farewell_teammate),e.bind("roll_call",team_app.join_team),e.bind("chat_message",team_app.receive_chat),e.bind("outline_team_clue",team_app.outline_team_clue),team_app.roll_call(),$("#team-chat .row-topper").on("click",team_app.toggle_chat),$(".clue").on("click",team_app.show_team_clue),$(window).on("unload",team_app.leave_team)})}).call(this);