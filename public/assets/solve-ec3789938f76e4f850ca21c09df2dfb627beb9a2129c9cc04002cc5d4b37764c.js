(function(){window.cw={selected:null,select_across:!0,counter:1,editing:!1,UP:38,RIGHT:39,DOWN:40,LEFT:37,COMMAND:91,ENTER:13,SPACE:32,DELETE:8,SHIFT:16,TAB:9,ESCAPE:27,BACKSPACE:8,HYPHEN:189,unhighlight_all:function(){if(cw.selected)return cw.selected.removeClass("selected"),cw.selected=null,$(".selected-word").removeClass("selected-word"),$(".selected-clue").removeClass("selected-clue")},highlight_next_word:function(){var e,t;return e=$(".clue.selected-clue"),t=e.nextAll(":not(.hidden)").first(),t.hasClass("clue")?cw.highlight_clue_cell(t):cw.highlight_clue_cell(e.parent().parent().siblings(".clue-column").first().children().children().first())},scroll_to_selected:function(){var e,t,s;return t=$(".selected-clue"),e=t.closest("ol"),s=e.scrollTop()+t.position().top-e.height()/2+t.height()/2,e.stop().animate({scrollTop:s},100)},selected_word:function(){var e;return e="",$.each($(".selected-word"),function(t,s){return e+=$(s).get_letter()}),e},word_highlight:function(){var e,t,s;return $(".selected-word").removeClass("selected-word"),e=$(".selected"),s=e.get_word_cells(),$.each(s,function(e,t){return t.addClass("selected-word")}),t=e.get_start_cell(),t.corresponding_clue().addClass("selected-clue"),cw.scroll_to_selected()},get_puzzle_letters:function(){var e,t;return t="",e=$(".cell"),$.each(e,function(e,s){return t+=$(s).hasClass("void")?"_":$(s).get_letter()}),t},number_cells:function(){var e,t;return cw.counter=1,e=$(".cell:not(.void)"),$.each(e,function(e,t){return cw.number_cell($(t))}),t=1},number_cell:function(e){return e.has_above()&&e.has_left()?" "!==e.get_number()?(e.set_number(""),e.removeAttr("data-cell")):void 0:(e.set_number(cw.counter),e.attr("data-cell",cw.counter),cw.counter+=1)},keypress:function(e){var t,s,l,c;if(!(e.ctrlKey||e.altKey||e.metaKey)&&cw.selected&&0===$(":focus").length)switch(s=e.which){case cw.UP:if(cw.selected)return cw.selected.cell_above()?cw.selected.cell_above().highlight():(c=cw.selected.get_col_end(),c.is_void()&&(c=c.cell_above()),c.highlight());break;case cw.RIGHT:if(cw.selected)return cw.selected.cell_to_right()?cw.selected.cell_to_right().highlight():(c=cw.selected.get_row_beginning(),c.is_void()&&(c=c.cell_to_right()),c.highlight());break;case cw.DOWN:if(cw.selected)return cw.selected.cell_below()?cw.selected.cell_below().highlight():(c=cw.selected.get_col_beginning(),c.is_void()&&(c=c.cell_below()),c.highlight());break;case cw.LEFT:if(cw.selected)return cw.selected.cell_to_left()?cw.selected.cell_to_left().highlight():(c=cw.selected.get_row_end(),c.is_void()&&(c=c.cell_to_left()),c.highlight());break;case cw.TAB:return e.preventDefault(),cw.highlight_next_word();case cw.ESCAPE:return e.preventDefault(),cw.unhighlight_all();case cw.ENTER:return e.preventDefault(),cw.selected.next_empty_cell().highlight();case cw.SHIFT:break;case cw.DELETE:break;case cw.SPACE:return cw.select_across=!cw.select_across,$(".selected").highlight();default:if(cw.selected&&(l=String.fromCharCode(s),s===cw.HYPHEN&&(l="-"),l!==cw.selected.get_letter()&&(cw.editing?(cw.selected.set_letter(l,!0),edit_app.update_unsaved()):(t=cw.selected.is_empty_cell(),cw.selected.set_letter(l,!0),t&&cw.selected.check_finisheds(),solve_app.update_unsaved())),!cw.selected.is_word_end()))return cw.selected.next_empty_cell_in_word().highlight()}},highlight_clue_cell:function(e){var t;if(t=cw.editing?$(".cell[data-id='"+e.data("cell-id")+"']").first():$(".cell[data-cell='"+e.attr("data-cell-num")+"']").first(),cw.select_across="across"===e.closest(".clues").attr("id"),t.highlight(),cw.editing)return e.children("input").select()},suppressBackspaceAndNav:function(e){var t,s;return e=e||window.event,s=e.target||e.srcElement,e.keyCode!==cw.BACKSPACE||/input|textarea/i.test(s.nodeName)?!(_.contains(cw.PAGE_NAV_KEYS,e.keyCode)&&!/input|textarea/i.test(s.nodeName))&&void 0:(t=!cw.selected.is_empty_cell(),cw.selected.delete_letter(!0),t&&cw.selected.uncheck_unfinisheds(),!1)}},cw.PAGE_NAV_KEYS=[cw.UP,cw.RIGHT,cw.DOWN,cw.LEFT,cw.SPACE],document.onkeydown=cw.suppressBackspaceAndNav,document.onkeypress=cw.suppressBackspaceAndNav,$(function(){return cw.editing||cw.number_cells(),$(document).on("keydown",cw.keypress),$(".cell").on("click",function(e){return e.stopPropagation(),$("#unpublished_crossword_one_click_void").prop("checked")?$(this).toggle_void(!0):$("#unpublished_crossword_circle_mode").prop("checked")?$(this).toggleCircle():$(this).highlight()}),$(".clue").on("click",function(e){return e.stopPropagation(),cw.highlight_clue_cell($(this))}),cw.selected=$(".cell:not(.void)").first(),cw.selected.highlight()})}).call(this),function(){window.solve_app={logged_in:null,crossword_id:null,solution_id:null,save_timer:null,clock_updater:null,last_save:null,unsaved_changes:!1,ready:function(){return solve_app.anonymous||(solve_app.save_timer=window.setInterval(function(){if(solve_app.unsaved_changes)return solve_app.save_solution()},5e3),solve_app.clock_updater=window.setInterval(solve_app.update_clock,1e4),$("#comments").on("keypress",".reply-content",solve_app.add_comment_or_reply),$("#comments").on("click",".reply-button.reply",solve_app.toggle_reply_form),$("#solve-save").on("click",solve_app.save_solution),$("#add-comment").on("keypress",solve_app.add_comment_or_reply),$(".cancel-button").on("click",solve_app.toggle_reply_form)),$("#controls-button").on("click",function(e){return e.preventDefault(),$("#controls-modal").foundation("reveal","open")}),$("#check-cell").on("click",solve_app.check_cell),$("#check-word").on("click",solve_app.check_word),$("#check-puzzle").on("click",solve_app.check_puzzle),$("#solve-controls").on("click",".check-completion :not(span)",solve_app.check_completion),$("input, textarea").on("click",function(){return cw.unhighlight_all()}),solve_app.check_all_finished(),!0},save_solution:function(e){var t,s,l;return e&&e.preventDefault(),l=$("#crossword").data("auth-token"),t=cw.get_puzzle_letters(),s={dataType:"script",type:"PUT",url:"/solutions/"+solve_app.solution_id,data:{authenticity_token:l,letters:t}},$.ajax(s)},log_save:function(){return solve_app.last_save=moment().format("dddd, MMMM Do YYYY, h:mm:ss a"),solve_app.unsaved_changes=!1},update_clock:function(){if(solve_app.last_save&&!solve_app.anonymous)return $("#save-status").text("Saved "),$("#save-clock").text(moment(solve_app.last_save).fromNow())},update_unsaved:function(){if(!solve_app.anonymous)return solve_app.unsaved_changes=!0,$("#save-status").text("Unsaved changes"),$("#save-clock").empty()},check_cell:function(e){var t,s,l;if(e.preventDefault(),cw.selected)return cw.selected.is_empty_cell()?alert("This cell is empty."):(t=cw.selected.data("index"),s=cw.selected.get_letter(),l={dataType:"script",type:"POST",url:"/crosswords/"+solve_app.crossword_id+"/check_cell",data:{letters:[s],indices:[]}},l.data.indices.push(t),$.ajax(l),solve_app.save_solution())},check_word:function(e){var t,s,l,c,n,o,r;if(e.preventDefault(),cw.selected){for(r={dataType:"script",type:"POST",url:"/crosswords/"+solve_app.crossword_id+"/check_cell",data:{letters:[],indices:[]}},o=cw.selected.get_word_cells(),s=0,c=o.length;s<c;s++)t=o[s],t.is_empty_cell()||(l=t.data("index"),n=t.get_letter(),r.data.indices.push(l),r.data.letters.push(n));return 0===r.data.letters.length?alert("The selected word is empty."):($.ajax(r),solve_app.save_solution())}},check_puzzle:function(e){var t;return e.preventDefault(),solve_app.save_solution(),t={dataType:"script",type:"POST",url:"/crosswords/"+solve_app.crossword_id+"/check_cell",data:{letters:cw.get_puzzle_letters()}},$.ajax(t),solve_app.save_solution()},check_completion:function(e){var t,s;return e.preventDefault(),solve_app.save_solution(),t=cw.get_puzzle_letters(),s={dataType:"script",type:"POST",url:"/crosswords/"+solve_app.crossword_id+"/check_completion",data:{letters:t}},solve_app.anonymous||(s.data.solution_id=solve_app.solution_id),$.ajax(s)},add_comment_or_reply:function(e){var t;if(!e.metaKey&&(t=e.which,t===cw.ENTER&&(e.preventDefault(),""!==$(this).val())))return $(".replying").removeClass("replying"),$(this).closest(".comment").addClass("replying"),$(this).parent().submit(),$(this).val("")},toggle_reply_form:function(e){var t,s;return e&&e.preventDefault(),s=$(this).siblings("form"),s.toggle("fast"),$(this).siblings("a").toggle(),$(this).toggle(),t=s.css("opacity")<.5,t?s.children("textarea").focus():s[0].reset()},check_all_finished:function(){return $.each($(".cell:not(.void)"),function(e,t){if($(t).has_left()||$(t).in_finished_across_word()&&$(t).corresponding_across_clue().addClass("crossed-off"),!$(t).has_above()&&$(t).in_finished_down_word())return $(t).corresponding_down_clue().addClass("crossed-off")})}},function(e){return e.fn.delete_letter=function(e){return this.is_empty_cell()?this.is_word_start()?void 0:(this.previous_cell().is_empty_cell()||(this.previous_cell().delete_letter(!0),solve_app.update_unsaved()),this.previous_cell().highlight(),!1):(this.children(".letter").first().empty(),"undefined"!=typeof team_app&&null!==team_app&&(e?team_app.send_team_cell(this,""):this.uncheck_unfinisheds()),solve_app.update_unsaved())}}(jQuery),$(document).ready(solve_app.ready)}.call(this),function(){!function(e){e.fn.get_row=function(){return this.data("row")},e.fn.get_col=function(){return this.data("col")},e.fn.is_void=function(){return this.hasClass("void")},e.fn.in_top_row=function(){return 1===e(this).get_row()},e.fn.in_bottom_row=function(){return this.get_row()===e("#crossword").data("rows")},e.fn.in_left_col=function(){return 1===this.get_col()},e.fn.in_right_col=function(){return this.get_col()===e("#crossword").data("cols")},e.fn.get_row_beginning=function(){var t;return t=parseInt(this.get_row()),e(".cell[data-row="+t+"][data-col=1]")},e.fn.get_row_end=function(){var t;return t=parseInt(this.get_row()),e(".cell[data-row="+t+"][data-col="+e("#crossword").data("cols")+"]")},e.fn.get_col_beginning=function(){var t;return t=parseInt(this.get_col()),e(".cell[data-row=1][data-col="+t+"]")},e.fn.get_col_end=function(){var t;return t=parseInt(this.get_col()),e(".cell[data-row="+e("#crossword").data("rows")+"][data-col="+t+"]")},e.fn.has_above=function(){var t,s,l;return!this.in_top_row()&&(l=parseInt(this.get_row()),s=parseInt(this.get_col()),t=e(".cell[data-row='"+(l-1)+"'][data-col='"+s+"']"),!t.is_void())},e.fn.has_below=function(){var t,s,l;return!this.in_bottom_row()&&(l=parseInt(this.get_row()),s=parseInt(this.get_col()),t=e(".cell[data-row='"+(l+1)+"'][data-col='"+s+"']"),!t.is_void())},e.fn.has_left=function(){var t,s,l;return!this.in_left_col()&&(l=parseInt(this.get_row()),t=parseInt(this.get_col()),s=e(".cell[data-row='"+l+"'][data-col='"+(t-1)+"']"),!s.is_void())},e.fn.has_right=function(){var t,s,l;return!this.in_right_col()&&(l=parseInt(this.get_row()),t=parseInt(this.get_col()),s=e(".cell[data-row='"+l+"'][data-col='"+(t+1)+"']"),!s.is_void())},e.fn.cell_to_left=function(){var e;return!this.in_left_col()&&(e=this.prevAll(".cell:not(.void)").first(),!!e.get(0)&&e)},e.fn.cell_to_right=function(){var e;return!this.in_right_col()&&(e=this.nextAll(".cell:not(.void)").first(),!!e.get(0)&&e)},e.fn.cell_above=function(){var t,s,l;return!this.in_top_row()&&(l=parseInt(this.get_row()),s=parseInt(this.get_col()),t=e(".cell[data-row='"+(l-1)+"'][data-col='"+s+"']"),t.is_void()?t.cell_above():t)},e.fn.cell_below=function(){var t,s,l;return!this.in_bottom_row()&&(l=parseInt(this.get_row()),s=parseInt(this.get_col()),t=e(".cell[data-row='"+(l+1)+"'][data-col='"+s+"']"),t.is_void()?t.cell_below():t)},e.fn.previous_cell=function(){return cw.select_across?this.cell_to_left():this.cell_above()},e.fn.next_cell=function(){return cw.select_across?this.cell_to_right():this.cell_below()},e.fn.is_word_start=function(){return!(cw.select_across?this.has_left():this.has_above())},e.fn.is_word_end=function(){return!(cw.select_across?this.has_right():this.has_below())},e.fn.get_down_word_cells=function(){return this.get_down_start_cell().down_word_from_start()},e.fn.get_down_start_cell=function(){return this.has_above()?this.cell_above().get_down_start_cell():this},e.fn.get_down_end_cell=function(){return this.has_below()?this.cell_below().get_down_end_cell():this},e.fn.down_word_from_start=function(){return this.has_below()?[this].concat(this.cell_below().down_word_from_start()):[this]},e.fn.get_down_word=function(){return e.map(this.get_down_word_cells(),function(e){return e.text()}).join("")},e.fn.get_across_word_cells=function(){return this.get_across_start_cell().across_word_from_start()},e.fn.get_across_start_cell=function(){return this.has_left()?this.cell_to_left().get_across_start_cell():this},e.fn.get_across_end_cell=function(){return this.has_right()?this.cell_to_right().get_across_end_cell():this},e.fn.across_word_from_start=function(){return this.has_right()?[this].concat(this.cell_to_right().across_word_from_start()):[this]},e.fn.get_across_word=function(){return e.map(this.get_across_word_cells(),function(e){return e.text()}).join("")},e.fn.get_word_cells=function(){return cw.select_across?this.get_across_word_cells():this.get_down_word_cells()},e.fn.word_from_start=function(){return cw.select_across?this.across_word_from_start():this.down_word_from_start()},e.fn.get_start_cell=function(){return cw.select_across?this.get_across_start_cell():this.get_down_start_cell()},e.fn.get_end_cell=function(){return cw.select_across?this.get_across_end_cell():this.get_down_end_cell()},e.fn.get_number=function(){var e;return e=this.children(".cell-num").text(),e.length>0?e:" "},e.fn.set_number=function(e){this.children(".cell-num").text(e)},e.fn.get_letter=function(){var e;return e=this.children(".letter").first().text().replace(/\n/g,"").replace(RegExp("  +","g"),""),e.length>0?e:" "},e.fn.set_letter=function(e,t){this.children(".letter").first().text(e),"undefined"!=typeof team_app&&null!==team_app&&(t?team_app.send_team_cell(this,e):this.check_finisheds())},e.fn.is_last_letter_of_puzzle=function(){var e,t;return t=cw.select_across?this.get_across_word_cells():this.get_down_word_cells(),e=t.length-1,this[0]===t[e][0]},e.fn.is_empty_cell=function(){return""===this.get_letter()||" "===this.get_letter()||" "===this.get_letter().replace(/\n/g,"").replace(RegExp("  +","g")," ")},e.fn.corresponding_across_clue=function(){return e(this.data("cell")?".across-clue[data-cell-num="+this.data("cell")+"]":".across-clue[data-index="+this.data("index")+"]")},e.fn.corresponding_down_clue=function(){return e(this.data("cell")?".down-clue[data-cell-num="+this.data("cell")+"]":".down-clue[data-index="+this.data("index")+"]")},e.fn.corresponding_clue=function(){return cw.select_across?this.corresponding_across_clue():this.corresponding_down_clue()},e.fn.highlight=function(){this.hasClass("cell")&&!this.is_void()&&(cw.unhighlight_all(),cw.selected=this,this.addClass("selected"),cw.word_highlight())},e.fn.in_finished_across_word=function(){var e,t,s;for(e=this.get_across_word_cells(),s=!0,t=0;t<e.length;){if(e[t].is_empty_cell()){s=!1;break}t++}return s},e.fn.in_finished_down_word=function(){var e,t,s;for(e=this.get_down_word_cells(),s=!0,t=0;t<e.length;){if(e[t].is_empty_cell()){s=!1;break}t++}return s},e.fn.in_finished_word=function(){var e,t,s;for(e=this.get_word_cells(),s=!0,t=0;t<e.length;){if(e[t].is_empty_cell()){s=!1;break}t++}return s},e.fn.in_directional_finished_word=function(){return cw.select_across?this.in_finished_across_word():this.in_finished_down_word()},e.fn.check_finisheds=function(){this.in_finished_across_word()&&this.get_across_start_cell().corresponding_across_clue().addClass("crossed-off"),this.in_finished_down_word()&&this.get_down_start_cell().corresponding_down_clue().addClass("crossed-off")},e.fn.uncheck_unfinisheds=function(){this.get_across_start_cell().corresponding_across_clue().removeClass("crossed-off"),this.get_down_start_cell().corresponding_down_clue().removeClass("crossed-off")},e.fn.next_empty_cell_in_word=function(){return this.is_word_end()||this.is_empty_cell()?this:this.next_cell().next_empty_cell_in_word()},e.fn.next_empty_cell=function(){var t;return this.is_last_letter_of_puzzle()?this.is_empty_cell()?this:(cw.highlight_next_word(),1!==e(".selected").get_number()?e(".selected").is_empty_cell()?e(".selected"):e(".selected").next_empty_cell():void 0):(t=this.next_cell(),t.is_empty_cell()?t:t.next_empty_cell())}}(jQuery)}.call(this);