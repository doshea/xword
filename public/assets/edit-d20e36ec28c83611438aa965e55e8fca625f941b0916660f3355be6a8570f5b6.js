(function(){window.cw={selected:null,select_across:!0,counter:1,editing:!1,UP:38,RIGHT:39,DOWN:40,LEFT:37,COMMAND:91,ENTER:13,SPACE:32,DELETE:8,SHIFT:16,TAB:9,ESCAPE:27,BACKSPACE:8,HYPHEN:189,unhighlight_all:function(){if(cw.selected)return cw.selected.removeClass("selected"),cw.selected=null,$(".selected-word").removeClass("selected-word"),$(".selected-clue").removeClass("selected-clue")},highlight_next_word:function(){var e,t;return e=$(".clue.selected-clue"),t=e.nextAll(":not(.hidden)").first(),t.hasClass("clue")?cw.highlight_clue_cell(t):cw.highlight_clue_cell(e.parent().parent().siblings(".clue-column").first().children().children().first())},scroll_to_selected:function(){var e,t,s;return t=$(".selected-clue"),e=t.closest("ol"),s=e.scrollTop()+t.position().top-e.height()/2+t.height()/2,e.stop().animate({scrollTop:s},100)},selected_word:function(){var e;return e="",$.each($(".selected-word"),function(t,s){return e+=$(s).get_letter()}),e},word_highlight:function(){var e,t,s;return $(".selected-word").removeClass("selected-word"),e=$(".selected"),s=e.get_word_cells(),$.each(s,function(e,t){return t.addClass("selected-word")}),t=e.get_start_cell(),t.corresponding_clue().addClass("selected-clue"),cw.scroll_to_selected()},get_puzzle_letters:function(){var e,t;return t="",e=$(".cell"),$.each(e,function(e,s){return t+=$(s).hasClass("void")?"_":$(s).get_letter()}),t},number_cells:function(){var e,t;return cw.counter=1,e=$(".cell:not(.void)"),$.each(e,function(e,t){return cw.number_cell($(t))}),t=1},number_cell:function(e){return e.has_above()&&e.has_left()?" "!==e.get_number()?(e.set_number(""),e.removeAttr("data-cell")):void 0:(e.set_number(cw.counter),e.attr("data-cell",cw.counter),cw.counter+=1)},keypress:function(e){var t,s,n,c;if(!(e.ctrlKey||e.altKey||e.metaKey)&&cw.selected&&0===$(":focus").length)switch(s=e.which){case cw.UP:if(cw.selected)return cw.selected.cell_above()?cw.selected.cell_above().highlight():(c=cw.selected.get_col_end(),c.is_void()&&(c=c.cell_above()),c.highlight());break;case cw.RIGHT:if(cw.selected)return cw.selected.cell_to_right()?cw.selected.cell_to_right().highlight():(c=cw.selected.get_row_beginning(),c.is_void()&&(c=c.cell_to_right()),c.highlight());break;case cw.DOWN:if(cw.selected)return cw.selected.cell_below()?cw.selected.cell_below().highlight():(c=cw.selected.get_col_beginning(),c.is_void()&&(c=c.cell_below()),c.highlight());break;case cw.LEFT:if(cw.selected)return cw.selected.cell_to_left()?cw.selected.cell_to_left().highlight():(c=cw.selected.get_row_end(),c.is_void()&&(c=c.cell_to_left()),c.highlight());break;case cw.TAB:return e.preventDefault(),cw.highlight_next_word();case cw.ESCAPE:return e.preventDefault(),cw.unhighlight_all();case cw.ENTER:return e.preventDefault(),cw.selected.next_empty_cell().highlight();case cw.SHIFT:break;case cw.DELETE:break;case cw.SPACE:return cw.select_across=!cw.select_across,$(".selected").highlight();default:if(cw.selected&&(n=String.fromCharCode(s),s===cw.HYPHEN&&(n="-"),n!==cw.selected.get_letter()&&(cw.editing?(cw.selected.set_letter(n,!0),edit_app.update_unsaved()):(t=cw.selected.is_empty_cell(),cw.selected.set_letter(n,!0),t&&cw.selected.check_finisheds(),solve_app.update_unsaved())),!cw.selected.is_word_end()))return cw.selected.next_empty_cell_in_word().highlight()}},highlight_clue_cell:function(e){var t;if(t=cw.editing?$(".cell[data-id='"+e.data("cell-id")+"']").first():$(".cell[data-cell='"+e.attr("data-cell-num")+"']").first(),cw.select_across="across"===e.closest(".clues").attr("id"),t.highlight(),cw.editing)return e.children("input").select()},suppressBackspaceAndNav:function(e){var t,s;return e=e||window.event,s=e.target||e.srcElement,e.keyCode!==cw.BACKSPACE||/input|textarea/i.test(s.nodeName)?!(_.contains(cw.PAGE_NAV_KEYS,e.keyCode)&&!/input|textarea/i.test(s.nodeName))&&void 0:(t=!cw.selected.is_empty_cell(),cw.selected.delete_letter(!0),t&&cw.selected.uncheck_unfinisheds(),!1)}},cw.PAGE_NAV_KEYS=[cw.UP,cw.RIGHT,cw.DOWN,cw.LEFT,cw.SPACE],document.onkeydown=cw.suppressBackspaceAndNav,document.onkeypress=cw.suppressBackspaceAndNav,$(function(){return cw.editing||cw.number_cells(),$(document).on("keydown",cw.keypress),$(".cell").on("click",function(e){return e.stopPropagation(),$("#unpublished_crossword_one_click_void").prop("checked")?$(this).toggle_void(!0):$("#unpublished_crossword_circle_mode").prop("checked")?$(this).toggleCircle():$(this).highlight()}),$(".clue").on("click",function(e){return e.stopPropagation(),cw.highlight_clue_cell($(this))}),cw.selected=$(".cell:not(.void)").first(),cw.selected.highlight()})}).call(this),function(){cw.editing=!0,window.edit_app={unsaved_changes:!1,save_timer:null,last_save:null,SAVE_INTERVAL:15e3,title_spinner:null,save_counter:null,ready:function(){return edit_app.save_timer=window.setInterval(function(){if(edit_app.unsaved_changes)return edit_app.save_puzzle()},edit_app.SAVE_INTERVAL),$("#title-status").show(),$("#crossword").on("dblclick",".cell",function(){return $(this).toggle_void(!0)}),$("#edit-save").on("click",edit_app.save_puzzle),$("#title").on("change",edit_app.update_title),$(".clue").on("change","input",edit_app.update_clue),$(".clue").on("click",function(){return $(".cell[data-index="+$(this).data("index")+"]").highlight()}),$("#description").on("change",edit_app.update_description),$(".switch-form input").on("click",edit_app.flip_switch),$(":not(.cell, .cell *, .clue, .clue *)").on("click",function(){return cw.unhighlight_all()}),$("#ideas input[name=word]").on("keypress",edit_app.add_potential_word),$("#settings-button").on("click",function(){return $("#edit-settings").foundation("reveal","open")}),$(".bottom-button").on("click",function(){return $(this).closest(".slide-up-container").toggleClass("open")})},flip_switch:function(){return $(this).parent().toggleClass("on off"),$(this).closest("form").submit()},add_potential_word:function(e){var t;if(!e.metaKey&&(t=e.which,t===cw.ENTER&&(e.preventDefault(),""!==$(this).val())))return $(this).parent().submit()},update_clue:function(){return edit_app.update_unsaved()},update_title:function(){var e,t,s,n;return s=$("#title-status"),s.css("opacity",1),n=$("#crossword").data("auth-token"),e=$("#crossword").data("id"),t={dataType:"script",type:"PUT",url:"/unpublished_crosswords/"+e,data:{unpublished_crossword:{title:$("#title").val()},authenticity_token:n},success:function(){return s.addClass("fi-check").removeClass("fi-x")},error:function(){return s.addClass("fi-x").removeClass("fi-check")},complete:function(){return s.fadeTo(1500,0,function(){return s.removeClass("fi-check fi-x")})}},$.ajax(t)},update_description:function(){var e,t,s;return s=$("#crossword").data("auth-token"),e=$("#crossword").data("id"),t={dataType:"script",type:"PUT",url:"/unpublished_crosswords/"+e,data:{unpublished_crossword:{description:$("#description").val()},authenticity_token:s},error:function(){return alert("Error updating title!")}},$.ajax(t)},update_unsaved:function(){return edit_app.unsaved_changes=!0,edit_app.save_counter=Math.random().toString(),$("#save-status").text("Unsaved changes"),$("#save-clock").empty()},spin_title:function(){var e,t;return $(".spinner").remove(),e={lines:10,length:7,width:4,radius:6,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},t=document.getElementById("title-status"),edit_app.title_spinner=new Spinner(e).spin(t)},number_clues:function(){return $(".clue").each(function(){var e,t,s;return s=$(this).children(".clue-num"),e=$(this).data("index"),t=parseInt($(".cell[data-index="+e+"]").first().attr("data-cell")),s.text(t+".")})},save_puzzle:function(){var e,t,s,n,c,r,l;return c=[],e=$(".cell"),$.each(e,function(e,t){return $(t).is_void()?c[e]=0:c[e]=$(t).get_letter()}),t=[],s=[],$.each($(".across-clue"),function(){return t.push($(this).children("input").val())}),$.each($(".down-clue"),function(){return s.push($(this).children("input").val())}),l=$("#crossword").data("auth-token"),n=$("#crossword").data("id"),r={dataType:"script",contentType:"application/json",type:"PATCH",url:"/unpublished_crosswords/"+n+"/update_letters",data:JSON.stringify({letters:c,circles:edit_app.circles,across_clues:t,down_clues:s,authenticity_token:l,save_counter:edit_app.save_counter}),success:function(){return console.log("Saved!")},error:function(){return alert("Error updating letters!")}},console.log("Saving..."),$.ajax(r)},log_save:function(){return edit_app.last_save=moment().format("dddd, MMMM Do YYYY, h:mm:ss a"),edit_app.unsaved_changes=!1},update_clock:function(){if(edit_app.last_save)return $("#save-status").text("Saved "),$("#save-clock").text(moment(edit_app.last_save).fromNow())}},function(e){return e.fn.corresponding_clues=function(){return e(".clue[data-index="+this.data("index")+"]")},e.fn.delete_letter=function(){return this.is_empty_cell()?this.is_word_start()?void 0:(this.previous_cell().is_empty_cell()||this.previous_cell().delete_letter(!0),this.previous_cell().highlight(),!1):this.children(".letter").first().empty()},e.fn.get_mirror_cell=function(){var t,s,n;return t=e(".cell"),s=t.length,n=e.inArray(this[0],t),e(t[s-n-1])},e.fn.toggleCircle=function(){var t,s,n,c;return n=e(this).children(".circle"),c=e(this).data("index"),s=edit_app.circles.split(""),n.length>0?(n.remove(),s[c]=" "):(t=e("<div>").addClass("circle"),e(this).append(t),s[c]="o"),edit_app.circles=s.join(""),edit_app.update_unsaved()},e.fn.toggle_void=function(t){var s,n;return this.set_letter(""),this.toggleClass("void"),this.hasClass("void")?(this.corresponding_clues().hide(),this.has_below()&&this.cell_below().corresponding_clues().filter(".down-clue").show(),this.has_right()&&this.cell_to_right().corresponding_clues().filter(".across-clue").show()):(this.has_below()&&this.cell_below().corresponding_clues().filter(".down-clue").hide(),this.has_right()&&this.cell_to_right().corresponding_clues().filter(".across-clue").hide(),this.cell_above()||this.corresponding_clues().filter(".down-clue").show(),this.cell_to_left()||this.corresponding_clues().filter(".across-clue").show()),t&&e("#unpublished_crossword_mirror_voids").prop("checked")&&(s=this.get_mirror_cell(),this[0]!==s[0]&&this.hasClass("void")!==s.hasClass("void")&&s.toggle_void(!1)),t&&(n=cw.select_across?this.cell_to_right():this.cell_below(),n.highlight()),cw.number_cells(),edit_app.number_clues(),edit_app.update_unsaved()}}(jQuery),$(document).ready(edit_app.ready)}.call(this),function(){!function(e){e.fn.get_row=function(){return this.data("row")},e.fn.get_col=function(){return this.data("col")},e.fn.is_void=function(){return this.hasClass("void")},e.fn.in_top_row=function(){return 1===e(this).get_row()},e.fn.in_bottom_row=function(){return this.get_row()===e("#crossword").data("rows")},e.fn.in_left_col=function(){return 1===this.get_col()},e.fn.in_right_col=function(){return this.get_col()===e("#crossword").data("cols")},e.fn.get_row_beginning=function(){var t;return t=parseInt(this.get_row()),e(".cell[data-row="+t+"][data-col=1]")},e.fn.get_row_end=function(){var t;return t=parseInt(this.get_row()),e(".cell[data-row="+t+"][data-col="+e("#crossword").data("cols")+"]")},e.fn.get_col_beginning=function(){var t;return t=parseInt(this.get_col()),e(".cell[data-row=1][data-col="+t+"]")},e.fn.get_col_end=function(){var t;return t=parseInt(this.get_col()),e(".cell[data-row="+e("#crossword").data("rows")+"][data-col="+t+"]")},e.fn.has_above=function(){var t,s,n;return!this.in_top_row()&&(n=parseInt(this.get_row()),s=parseInt(this.get_col()),t=e(".cell[data-row='"+(n-1)+"'][data-col='"+s+"']"),!t.is_void())},e.fn.has_below=function(){var t,s,n;return!this.in_bottom_row()&&(n=parseInt(this.get_row()),s=parseInt(this.get_col()),t=e(".cell[data-row='"+(n+1)+"'][data-col='"+s+"']"),!t.is_void())},e.fn.has_left=function(){var t,s,n;return!this.in_left_col()&&(n=parseInt(this.get_row()),t=parseInt(this.get_col()),s=e(".cell[data-row='"+n+"'][data-col='"+(t-1)+"']"),!s.is_void())},e.fn.has_right=function(){var t,s,n;return!this.in_right_col()&&(n=parseInt(this.get_row()),t=parseInt(this.get_col()),s=e(".cell[data-row='"+n+"'][data-col='"+(t+1)+"']"),!s.is_void())},e.fn.cell_to_left=function(){var e;return!this.in_left_col()&&(e=this.prevAll(".cell:not(.void)").first(),!!e.get(0)&&e)},e.fn.cell_to_right=function(){var e;return!this.in_right_col()&&(e=this.nextAll(".cell:not(.void)").first(),!!e.get(0)&&e)},e.fn.cell_above=function(){var t,s,n;return!this.in_top_row()&&(n=parseInt(this.get_row()),s=parseInt(this.get_col()),t=e(".cell[data-row='"+(n-1)+"'][data-col='"+s+"']"),t.is_void()?t.cell_above():t)},e.fn.cell_below=function(){var t,s,n;return!this.in_bottom_row()&&(n=parseInt(this.get_row()),s=parseInt(this.get_col()),t=e(".cell[data-row='"+(n+1)+"'][data-col='"+s+"']"),t.is_void()?t.cell_below():t)},e.fn.previous_cell=function(){return cw.select_across?this.cell_to_left():this.cell_above()},e.fn.next_cell=function(){return cw.select_across?this.cell_to_right():this.cell_below()},e.fn.is_word_start=function(){return!(cw.select_across?this.has_left():this.has_above())},e.fn.is_word_end=function(){return!(cw.select_across?this.has_right():this.has_below())},e.fn.get_down_word_cells=function(){return this.get_down_start_cell().down_word_from_start()},e.fn.get_down_start_cell=function(){return this.has_above()?this.cell_above().get_down_start_cell():this},e.fn.get_down_end_cell=function(){return this.has_below()?this.cell_below().get_down_end_cell():this},e.fn.down_word_from_start=function(){return this.has_below()?[this].concat(this.cell_below().down_word_from_start()):[this]},e.fn.get_down_word=function(){return e.map(this.get_down_word_cells(),function(e){return e.text()}).join("")},e.fn.get_across_word_cells=function(){return this.get_across_start_cell().across_word_from_start()},e.fn.get_across_start_cell=function(){return this.has_left()?this.cell_to_left().get_across_start_cell():this},e.fn.get_across_end_cell=function(){return this.has_right()?this.cell_to_right().get_across_end_cell():this},e.fn.across_word_from_start=function(){return this.has_right()?[this].concat(this.cell_to_right().across_word_from_start()):[this]},e.fn.get_across_word=function(){return e.map(this.get_across_word_cells(),function(e){return e.text()}).join("")},e.fn.get_word_cells=function(){return cw.select_across?this.get_across_word_cells():this.get_down_word_cells()},e.fn.word_from_start=function(){return cw.select_across?this.across_word_from_start():this.down_word_from_start()},e.fn.get_start_cell=function(){return cw.select_across?this.get_across_start_cell():this.get_down_start_cell()},e.fn.get_end_cell=function(){return cw.select_across?this.get_across_end_cell():this.get_down_end_cell()},e.fn.get_number=function(){var e;return e=this.children(".cell-num").text(),e.length>0?e:" "},e.fn.set_number=function(e){this.children(".cell-num").text(e)},e.fn.get_letter=function(){var e;return e=this.children(".letter").first().text().replace(/\n/g,"").replace(RegExp("  +","g"),""),e.length>0?e:" "},e.fn.set_letter=function(e,t){this.children(".letter").first().text(e),"undefined"!=typeof team_app&&null!==team_app&&(t?team_app.send_team_cell(this,e):this.check_finisheds())},e.fn.is_last_letter_of_puzzle=function(){var e,t;return t=cw.select_across?this.get_across_word_cells():this.get_down_word_cells(),e=t.length-1,this[0]===t[e][0]},e.fn.is_empty_cell=function(){return""===this.get_letter()||" "===this.get_letter()||" "===this.get_letter().replace(/\n/g,"").replace(RegExp("  +","g")," ")},e.fn.corresponding_across_clue=function(){return e(this.data("cell")?".across-clue[data-cell-num="+this.data("cell")+"]":".across-clue[data-index="+this.data("index")+"]")},e.fn.corresponding_down_clue=function(){return e(this.data("cell")?".down-clue[data-cell-num="+this.data("cell")+"]":".down-clue[data-index="+this.data("index")+"]")},e.fn.corresponding_clue=function(){return cw.select_across?this.corresponding_across_clue():this.corresponding_down_clue()},e.fn.highlight=function(){this.hasClass("cell")&&!this.is_void()&&(cw.unhighlight_all(),cw.selected=this,this.addClass("selected"),cw.word_highlight())},e.fn.in_finished_across_word=function(){var e,t,s;for(e=this.get_across_word_cells(),s=!0,t=0;t<e.length;){if(e[t].is_empty_cell()){s=!1;break}t++}return s},e.fn.in_finished_down_word=function(){var e,t,s;for(e=this.get_down_word_cells(),s=!0,t=0;t<e.length;){if(e[t].is_empty_cell()){s=!1;break}t++}return s},e.fn.in_finished_word=function(){var e,t,s;for(e=this.get_word_cells(),s=!0,t=0;t<e.length;){if(e[t].is_empty_cell()){s=!1;break}t++}return s},e.fn.in_directional_finished_word=function(){return cw.select_across?this.in_finished_across_word():this.in_finished_down_word()},e.fn.check_finisheds=function(){this.in_finished_across_word()&&this.get_across_start_cell().corresponding_across_clue().addClass("crossed-off"),this.in_finished_down_word()&&this.get_down_start_cell().corresponding_down_clue().addClass("crossed-off")},e.fn.uncheck_unfinisheds=function(){this.get_across_start_cell().corresponding_across_clue().removeClass("crossed-off"),this.get_down_start_cell().corresponding_down_clue().removeClass("crossed-off")},e.fn.next_empty_cell_in_word=function(){return this.is_word_end()||this.is_empty_cell()?this:this.next_cell().next_empty_cell_in_word()},e.fn.next_empty_cell=function(){var t;return this.is_last_letter_of_puzzle()?this.is_empty_cell()?this:(cw.highlight_next_word(),1!==e(".selected").get_number()?e(".selected").is_empty_cell()?e(".selected"):e(".selected").next_empty_cell():void 0):(t=this.next_cell(),t.is_empty_cell()?t:t.next_empty_cell())}}(jQuery)}.call(this);